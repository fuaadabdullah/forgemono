# üöÄ Deploying Goblin Assistant to Render (DEPRECATED)

> NOTE: This Render-specific deployment guide is deprecated. Goblin Assistant now uses Fly.io for production deployments. See `FLY_DEPLOYMENT.md` for up-to-date instructions.

## Quick Start (5 minutes)

### Option 1: Deploy via Render Dashboard (Recommended)

1. **Push your code to GitHub** (if not already done)
   ```bash
   cd /Users/fuaadabdullah/ForgeMonorepo
   git add .
   git commit -m "Ready for Render deployment"
   git push origin main
   ```

2. **Go to Render Dashboard**
   - Visit: https://dashboard.render.com
   - Click **"New +"** ‚Üí **"Blueprint"**
   - Connect your GitHub repository: `fuaadabdullah/forgemono`
   - Render will auto-detect `apps/goblin-assistant/render.yaml`
   - Click **"Apply"**

3. **Set Environment Variables**

   In the Render dashboard, add these **required** variables:

   ```bash
   # AI Provider API Keys (REQUIRED)
   ANTHROPIC_API_KEY=sk-ant-api03-your-key-here
   DEEPSEEK_API_KEY=sk-your-key-here
   GEMINI_API_KEY=AIzaSy-your-key-here
   GROK_API_KEY=xai-your-key-here

   # Database (AUTO-GENERATED by Render)
   # DATABASE_URL is automatically set if you use Render's PostgreSQL

   # Optional: Google OAuth
   GOOGLE_CLIENT_ID=your-google-client-id
   GOOGLE_CLIENT_SECRET=your-google-secret
   ```

4. **Deploy!**
   - Click **"Create Blueprint"**
   - Wait 5-10 minutes for deployment
   - Your app will be live at: `https://goblin-assistant-backend.onrender.com`

### Option 2: Deploy via Script

```bash
cd apps/goblin-assistant
./deploy-to-render.sh
```

Follow the interactive prompts!

---

## What Gets Deployed

The `render.yaml` configuration will create:

1. **Web Service**: Python FastAPI backend
   - Runtime: Python 3.11
   - Port: Auto-assigned by Render
   - Health check: `/health`
   - Auto-deploy on git push

2. **PostgreSQL Database** (Optional)
   - Starter plan (free tier available)
   - Automatically connected to your app
   - Connection string in `DATABASE_URL`

---

## After Deployment

### 1. Get Your Backend URL

After deployment completes, find your URL in Render dashboard:
```
https://goblin-assistant-backend.onrender.com
```

### 2. Test the Backend

```bash
# Health check
curl https://your-backend-url/health

# Should return:
# {"status":"healthy","timestamp":...}
```

### 3. Initialize Database

The database tables are automatically created on first startup via the `startup_event` in `backend/main.py`.

### 4. Update Frontend Configuration

Update your frontend's environment variable:

```bash
# In your frontend deployment (Netlify/Vercel)
VITE_FASTAPI_URL=https://goblin-assistant-backend.onrender.com
```

---

## Environment Variables Reference

### Required Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `ANTHROPIC_API_KEY` | Claude API key | `sk-ant-api03-...` |
| `DEEPSEEK_API_KEY` | DeepSeek API key | `sk-...` |
| `GEMINI_API_KEY` | Google Gemini key | `AIzaSy...` |
| `GROK_API_KEY` | xAI Grok API key | `xai-...` |

### Auto-Generated Variables

| Variable | Description | Generated By |
|----------|-------------|--------------|
| `PORT` | Server port | Render |
| `DATABASE_URL` | PostgreSQL connection | Render Database |
| `JWT_SECRET_KEY` | Auth token secret | Render (via generateValue) |

### Optional Variables

| Variable | Description |
|----------|-------------|
| `GOOGLE_CLIENT_ID` | OAuth client ID |
| `GOOGLE_CLIENT_SECRET` | OAuth secret |
| `SENTRY_DSN` | Error tracking |
| `POSTHOG_API_KEY` | Analytics |

---

## Troubleshooting

### Deployment Failed

**Check build logs:**
```bash
# In Render dashboard: Services ‚Üí Your Service ‚Üí Logs
```

**Common issues:**
- Missing dependencies in `requirements.txt` ‚úÖ Already fixed
- Database connection errors ‚Üí Check `DATABASE_URL`
- Missing API keys ‚Üí Add in Render dashboard

### Health Check Failing

The app exposes `/health` endpoint. If failing:

1. Check app logs in Render dashboard
2. Verify `PORT` environment variable
3. Ensure `start_server.py` is running correctly

### Database Errors

If you see database connection errors:

```bash
# Option 1: Use Render's PostgreSQL (Recommended)
# - Already configured in render.yaml
# - Automatically sets DATABASE_URL

# Option 2: Use external PostgreSQL
# - Set DATABASE_URL manually
DATABASE_URL=postgresql://user:password@host:5432/dbname

# Option 3: Use SQLite (Development only)
DATABASE_URL=sqlite:///./goblin_assistant.db
```

---

## Costs

### Free Tier
- **Web Service**: 750 hours/month free
- **PostgreSQL**: Free starter plan available
- **Total**: $0/month for starter usage

### Paid Plans
- **Starter**: $7/month (Web Service)
- **Standard**: $25/month+ (More resources)
- **Database**: $7/month+ (Production-grade)

---

## Scaling

Render automatically scales your app. To configure:

1. Go to **Service Settings**
2. Adjust **Instance Count** (horizontal scaling)
3. Change **Plan** for more resources (vertical scaling)

---

## Monitoring

### Health Checks
- Automatic health checks every 30 seconds
- Endpoint: `GET /health`
- Alerts if service is down

### Logs
View real-time logs in Render dashboard:
```
Services ‚Üí goblin-assistant-backend ‚Üí Logs
```

### Metrics
Available in Render dashboard:
- CPU usage
- Memory usage
- Request count
- Response times

---

## CI/CD (Auto-Deploy)

Render automatically deploys when you push to your main branch!

```bash
git add .
git commit -m "Update feature"
git push origin main
# Render automatically deploys! üöÄ
```

To disable auto-deploy:
- Service Settings ‚Üí Auto-Deploy ‚Üí OFF

---

## Security Notes

‚úÖ **Included in Deployment:**
- HTTPS/SSL certificates (automatic)
- Environment variable encryption
- Managed PostgreSQL with backups
- DDoS protection

‚ö†Ô∏è **Remember:**
- Never commit `.env` files with real secrets
- Rotate API keys regularly
- Use Render's secret management
- Enable Row Level Security in production database

---

## Support

- **Render Docs**: https://render.com/docs
- **Status Page**: https://status.render.com
- **Community**: https://community.render.com

---

**Last Updated**: December 1, 2025
**Platform**: Render.com
**Database**: PostgreSQL (SQLite compatible)
**Status**: ‚úÖ Ready for deployment
