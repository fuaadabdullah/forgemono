#!/usr/bin/env node

/**
 * Generate CSS Variables from Research-Backed Colors
 *
 * This script uses colorUtils.js to generate consistent color variants
 * and outputs CSS custom properties for the theme system.
 *
 * Usage:
 *   node scripts/generate-theme-css.js
 *   node scripts/generate-theme-css.js --output src/generated-theme.css
 */

import {
  generateVariants,
  hexToRgba,
  GOBLINOS_BASE_COLORS,
  generateCssVariables,
  GOBLINOS_PALETTE
} from '../src/utils/colorUtils.js';

const args = process.argv.slice(2);
const outputFile = args.includes('--output') ? args[args.indexOf('--output') + 1] : null;

// Generate complete theme CSS
function generateThemeCSS() {
  const lines = [
    '/* ============================================================================',
    '   GOBLINOS THEME - AUTO-GENERATED FROM RESEARCH-BACKED BASE COLORS',
    '   Generated by: scripts/generate-theme-css.js',
    `   Generated at: ${new Date().toISOString()}`,
    '   ============================================================================ */',
    '',
    ':root {',
    '  /* ===== Neutrals ===== */',
    `  --bg: ${GOBLINOS_BASE_COLORS.bg};`,
    `  --surface: ${GOBLINOS_BASE_COLORS.surface};`,
    `  --text: ${GOBLINOS_BASE_COLORS.text};`,
    `  --muted: ${GOBLINOS_BASE_COLORS.muted};`,
    '',
    '  /* ===== Primary (Goblin Green) - Auto-generated variants ===== */',
    `  --primary: ${GOBLINOS_PALETTE.primary.base};`,
    `  --primary-300: ${GOBLINOS_PALETTE.primary.light};`,
    `  --primary-600: ${GOBLINOS_PALETTE.primary.dark};`,
    `  --primary-hover: ${GOBLINOS_PALETTE.primary.hover};`,
    '',
    '  /* ===== Accent (Magenta) - Auto-generated variants ===== */',
    `  --accent: ${GOBLINOS_PALETTE.accent.base};`,
    `  --accent-300: ${GOBLINOS_PALETTE.accent.light};`,
    `  --accent-600: ${GOBLINOS_PALETTE.accent.dark};`,
    `  --accent-hover: ${GOBLINOS_PALETTE.accent.hover};`,
    '',
    '  /* ===== CTA (Burnt Orange) - Auto-generated variants ===== */',
    `  --cta: ${GOBLINOS_PALETTE.cta.base};`,
    `  --cta-300: ${GOBLINOS_PALETTE.cta.light};`,
    `  --cta-600: ${GOBLINOS_PALETTE.cta.dark};`,
    `  --cta-hover: ${GOBLINOS_PALETTE.cta.hover};`,
    '',
    '  /* ===== Effects - Auto-generated from base colors ===== */',
    `  --glow-primary: ${hexToRgba(GOBLINOS_BASE_COLORS.primary, 0.14)};`,
    `  --glow-accent: ${hexToRgba(GOBLINOS_BASE_COLORS.accent, 0.14)};`,
    `  --glow-cta: ${hexToRgba(GOBLINOS_BASE_COLORS.cta, 0.14)};`,
    '  --scanline: rgba(255, 255, 255, 0.03);',
    '}',
    '',
    '/* ===== High-Contrast Mode - Brightened variants ===== */',
    ':root.goblinos-high-contrast {',
    '  --text: #FFFFFF;',
    '  --muted: #D2D6D6;',
    `  --primary: ${GOBLINOS_PALETTE.primary.light};`,
    `  --primary-300: #88ffcc;`,
    `  --primary-600: ${GOBLINOS_PALETTE.primary.base};`,
    `  --glow-primary: ${hexToRgba(GOBLINOS_PALETTE.primary.light, 0.22)};`,
    '  --bg: #000000;',
    '  --surface: #0d1117;',
    '  --border: #3a4a56;',
    '}',
    ''
  ];

  return lines.join('\n');
}

// Generate verification data
function generateVerificationData() {
  return {
    generated_at: new Date().toISOString(),
    base_colors: GOBLINOS_BASE_COLORS,
    generated_variants: {
      primary: GOBLINOS_PALETTE.primary,
      accent: GOBLINOS_PALETTE.accent,
      cta: GOBLINOS_PALETTE.cta
    },
    glow_effects: {
      primary: hexToRgba(GOBLINOS_BASE_COLORS.primary, 0.14),
      accent: hexToRgba(GOBLINOS_BASE_COLORS.accent, 0.14),
      cta: hexToRgba(GOBLINOS_BASE_COLORS.cta, 0.14)
    }
  };
}

// Main execution
const css = generateThemeCSS();
const verification = generateVerificationData();

if (outputFile) {
  // Write to file
  const fs = await import('fs');
  fs.writeFileSync(outputFile, css);
  console.log(`✅ Theme CSS written to: ${outputFile}`);
} else {
  // Print to console
  console.log(css);
  console.log('\n=== Verification Data ===');
  console.log(JSON.stringify(verification, null, 2));
}

console.log('\n=== Color Variants Generated ===');
console.log(`Primary: ${GOBLINOS_BASE_COLORS.primary}`);
console.log(`  → Light (300): ${GOBLINOS_PALETTE.primary.light}`);
console.log(`  → Dark (600): ${GOBLINOS_PALETTE.primary.dark}`);
console.log(`  → Hover: ${GOBLINOS_PALETTE.primary.hover}`);
console.log(`\nAccent: ${GOBLINOS_BASE_COLORS.accent}`);
console.log(`  → Light (300): ${GOBLINOS_PALETTE.accent.light}`);
console.log(`  → Dark (600): ${GOBLINOS_PALETTE.accent.dark}`);
console.log(`\nCTA: ${GOBLINOS_BASE_COLORS.cta}`);
console.log(`  → Light (300): ${GOBLINOS_PALETTE.cta.light}`);
console.log(`  → Dark (600): ${GOBLINOS_PALETTE.cta.dark}`);
console.log('\n✨ All variants maintain HSL relationships for perceptual uniformity');
